<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scroll Snooper v0.0.3</title>
    <script src="scroll-snooper.js"></script>
    <style>
        body {
            font-family:AppleSystemUIFont, sans-serif; height:400vh;
            display:flex; align-items:center; justify-content:center;
        }
        .stats {
            position:fixed; top:50%; z-index:2; width:30vw;
            transform:translateY(-50%);
            font-size:2vw; line-height:1.5;
        }
        .stats.blue {color:cornflowerblue; left:3vw;}
        .stats.red {color:crimson; right:3vw; text-align:right;}
        #blue {
            width:10vw; height:10vw; border-radius:1vw; margin:0 5px;
            background:cornflowerblue; position:relative;
        }
        #red {
            width:10vw; height:120vh; border-radius:1vw; margin:0 5px;
            background:crimson; position:relative;
        }
        #blue:before, #red:before {
            content:"+"; position:absolute; top:50%; left:50%;
            transform:translate(-50%, -50%); font-size:3vw; color:#fff;
        }
        .events {font-size:.6em;}
        .event {background:#eee; color:#000; padding:.1em .2em; border-radius:.2em;}
        .event.on {background:limegreen;}
    </style>
</head>
<body>

<div class="stats blue" id="blue-stats">
    <div>isInViewport(<span contenteditable="true" id="blue_input">0</span>): <span id="blue_line_1">false</span></div>
    <div>progress: <span id="blue_line_2"></span></div>
    <div>events:
        <div class="events">
            <span class="event" id="blue_onScroll">onScroll</span>
            <span class="event" id="blue_onEnter">onEnter</span>
            <span class="event" id="blue_onLeave">onLeave</span>
        </div>
    </div>
</div>
<div class="stats red" id="red-stats">
    <div>isInViewport(<span contenteditable="true" id="red_input">0</span>): <span id="red_line_1">false</span></div>
    <div>progress: <span id="red_line_2"></span></div>
    <div>events:
        <div class="events">
            <span class="event" id="red_onScroll">onScroll</span>
            <span class="event" id="red_onEnter">onEnter</span>
            <span class="event" id="red_onLeave">onLeave</span>
        </div>
    </div>
</div>

<div id="blue"></div>
<div id="red"></div>

<script>
    const blocks = ['blue', 'red'];

    for(const block of blocks){
        const element = document.getElementById(block);
        // create scroll snooper
        ScrollSnooper.create({
            trigger: element,
            start: 'top bottom',
            end: 'bottom bottom',
            onEnter: data => {
                updateEvent(block, 'onEnter');
            },
            onLeave: data => {
                updateEvent(block, 'onLeave');
            },
            onScroll: data => {
                updateEvent(block, 'onScroll');

                // isInViewport
                const input = parseFloat(document.getElementById(`${block}_input`).innerText);
                const isInViewport = ScrollSnooper.isInViewport(data.trigger, input) ? 'true' : 'false';
                document.getElementById(`${block}_line_1`).innerText = `${isInViewport}`;

                // visibility
                const progress = data.progress.toFixed(2);
                document.getElementById(`${block}_line_2`).innerText = `${progress}`;
            }
        });
    }

    // events
    function updateEvent(block, event){
        document.getElementById(`${block}_${event}`).classList.add("on");
        setTimeout(() => {
            document.getElementById(`${block}_${event}`).classList.remove("on");
        }, 500);
    }

</script>

</body>
</html>